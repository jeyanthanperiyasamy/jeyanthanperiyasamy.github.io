<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#00539f" />
  <title>Tesco Collection ‚Äî Groceries & More (Chat + PayPal Mock)</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root { --blue:#00539f; --red:#ee1c2e; --ink:#1a1a1a; --muted:#4b5563; --bg:#f6f7fb; --line:#e5e7eb; --radius-lg:18px; --shadow:0 8px 24px rgba(0,0,0,.08); }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--ink)}
    .topbar{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--line);box-shadow:0 2px 10px rgba(0,0,0,.04)}
    .nav{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px}
    .logo{font-weight:900;font-size:1.2rem;color:var(--blue)}
    .search{flex:1}
    .search input{width:100%;padding:10px 40px 10px 12px;border:1px solid var(--line);border-radius:10px}
    .cart-btn{position:relative;background:#fff;border:1px solid var(--line);border-radius:10px;padding:8px 12px;cursor:pointer}
    .cart-count{position:absolute;top:-6px;right:-6px;background:var(--red);color:#fff;font-size:12px;font-weight:700;padding:2px 6px;border-radius:999px}
    header{text-align:center;padding:40px 20px 20px}
    header h1{font-family:'Playfair Display',serif;color:var(--blue);font-size:clamp(2rem,6vw,3rem);margin-bottom:8px}
    header p{color:var(--muted)}
    .wrap{max-width:1200px;margin:20px auto;padding:0 16px 140px}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:768px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:480px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius-lg);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .media{height:240px;font-size:3.4rem;display:grid;place-items:center;background:#f9fafb}
    .meta{padding:14px;display:grid;gap:6px}
    .brand{font-size:.75rem;font-weight:800;color:#fff;background:var(--blue);padding:4px 10px;border-radius:999px;width:fit-content}
    .title{font-weight:800}
    .unit{color:var(--muted);font-size:.9rem}
    .price-row{display:flex;justify-content:space-between;align-items:center}
    .price{color:var(--red);font-weight:900;font-size:1.1rem}
    .add{background:var(--blue);color:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:800;cursor:pointer}
    .checkout-section{background:#fff;border:1px solid var(--line);border-radius:var(--radius-lg);box-shadow:var(--shadow);max-width:1200px;margin:20px auto;padding:20px}
    .checkout-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .checkout-header h2{margin:0;font-size:1.4rem;color:var(--blue)}
    .checkout-total{font-weight:900;color:var(--red)}
    .cart-list{display:grid;gap:10px}
    .cart-item{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--line);border-radius:10px;padding:10px}
    .qty{display:flex;gap:6px;align-items:center}
    .qty button{width:26px;height:26px;border:none;background:#f3f4f6;font-weight:900;cursor:pointer;border-radius:6px}
    #paypal-button-container{margin-top:16px}
    .pp-btn{display:inline-flex;align-items:center;gap:8px;padding:12px 18px;border-radius:999px;border:0;cursor:pointer;font-weight:900;background:linear-gradient(45deg,#0070ba,#003087);color:#fff;box-shadow:0 8px 20px rgba(0,112,186,.35)}
    .pp-btn:hover{filter:brightness(1.05);transform:translateY(-1px)}
    .toast{position:fixed;top:16px;right:16px;background:var(--red);color:#fff;padding:12px 16px;border-radius:10px;font-weight:900;box-shadow:var(--shadow);transform:translateX(120%);transition:transform .3s ease;z-index:90}

    /* Chat */
    .chat-fab{position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:999px;border:0;background:var(--blue);color:#fff;font-size:22px;box-shadow:var(--shadow);z-index:65;cursor:pointer}
    .chat-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:60}
    .chat-backdrop.show{opacity:1;pointer-events:auto}
    .chat-panel{position:fixed;right:20px;bottom:80px;width:350px;max-height:70vh;display:none;flex-direction:column;border:1px solid var(--line);border-radius:12px;background:#fff;box-shadow:0 4px 20px rgba(0,0,0,.2);transform:translateY(10px);opacity:0;transition:transform .2s ease,opacity .2s ease;z-index:70}
    .chat-panel.open{transform:translateY(0);opacity:1}
    .chat-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line);background:#f9fafb}
    .chat-body{padding:12px;overflow-y:auto;display:grid;gap:10px}
    .chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line)}
    .chat-input input{flex:1;padding:10px 12px;border:1px solid var(--line);border-radius:10px}
    .chat-input button{padding:10px 14px;border-radius:10px;border:0;font-weight:800;background:var(--blue);color:#fff;cursor:pointer}
    .msg{padding:10px 12px;border-radius:12px;width:fit-content;max-width:85%;white-space:pre-wrap}
    .msg.user{background:#e8f1fb;justify-self:end}
    .msg.bot{background:#f3f4f6}
    .product-chip{display:inline-grid;gap:6px;padding:10px;border:1px solid var(--line);border-radius:12px;margin:6px 6px 0 0;background:#fff}
    .chip-title{font-weight:700}
    .chip-price{color:var(--red);font-weight:800}
    .pp-inline{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;background:linear-gradient(45deg,#0070ba,#003087);color:#fff;font-weight:800;text-decoration:none;box-shadow:var(--shadow)}
    .pp-inline:hover{filter:brightness(1.05);transform:translateY(-1px)}
    @media (max-width:768px){
      .chat-panel{left:0;right:0;bottom:0;width:100%;max-height:65vh;border-radius:16px 16px 0 0}
      .chat-header{cursor:grab}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="nav">
      <div class="logo">Tesco Collection</div>
      <div class="search"><input id="searchInput" type="search" placeholder="Search products‚Ä¶" /></div>
      <button id="openCart" class="cart-btn">üõí<span id="cartCount" class="cart-count">0</span></button>
    </div>
  </div>

  <header>
    <h1>Tesco Collection</h1>
    <p>Everyday groceries and trusted brands ‚Äî add to cart and pay with PayPal directly.</p>
  </header>

  <div class="wrap"><div id="grid" class="grid"></div></div>

  <section class="checkout-section">
    <div class="checkout-header"><h2>Your Cart</h2><div class="checkout-total" id="checkoutTotal">$0.00</div></div>
    <div id="cartList" class="cart-list"></div>
    <div id="paypal-button-container"></div>
  </section>

  <div id="toast" class="toast">Added to cart</div>

  <!-- Chat UI -->
  <button id="chatFab" class="chat-fab" aria-label="Open chat">üí¨</button>
  <div id="chatBackdrop" class="chat-backdrop" aria-hidden="true"></div>
  <div id="chatPanel" class="chat-panel" role="dialog" aria-modal="true" aria-labelledby="chatTitle">
    <div class="chat-header">
      <h3 id="chatTitle" style="margin:0;font-size:1rem;color:#00539f">Shopping Assistant</h3>
      <button id="chatClose" class="cart-btn" style="padding:6px 8px">‚úï</button>
    </div>
    <div id="chatBody" class="chat-body"></div>
    <form id="chatForm" class="chat-input">
      <input id="chatInput" type="text" placeholder="Try: snacks under $5 or fruit" autocomplete="off" />
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    // Catalog (mock)
    const PRODUCTS = [];
    const categories = ['Fruit','Dairy','Bakery','Veg','Pantry','Drinks','Snacks','Tech','Sport','Home'];
    const icons = ['üçé','üçå','ü•õ','üçû','ü•ï','ü•¶','üç´','üì±','üëü','üßª'];
    for (let i = 1; i <= 50; i++) {
      const cat = categories[i % categories.length];
      const icon = icons[i % icons.length];
      PRODUCTS.push({ id:'P'+i, brand:'TESCO', name:`Product ${i}`, icon, unit:'1 unit', price:(Math.random()*20+1).toFixed(2)-0, category:cat });
    }

    // Grid
    const grid = document.getElementById('grid');
    function card(p){
      const el=document.createElement('article');
      el.className='card';
      el.innerHTML = `
        <div class="media">${p.icon}</div>
        <div class="meta">
          <span class="brand">${p.brand}</span>
          <div class="title">${p.name}</div>
          <div class="unit">${p.unit}</div>
          <div class="price-row">
            <div class="price">$${p.price.toFixed(2)}</div>
            <button class="add" data-id="${p.id}">Add</button>
          </div>
        </div>`;
      return el;
    }
    function render(){ grid.innerHTML=''; PRODUCTS.forEach(p=>grid.appendChild(card(p))); }
    render();

    // PayPal stage URL (mock)
    const PAYPAL_URL='https://www.stage2d0068.stage.paypal.com/checkoutweb/?token=EC-52C48335RP6380056&modxo_redirect_reason=test&dumbledoreEligible=1';
    function generatePayPalUrl(items){
      const enriched = items.map(it => {
        const p = PRODUCTS.find(x=>x.id===it.id) || {};
        return { id: it.id, name: p.name || it.id, qty: it.qty||1, price: +(p.price||0) };
      });
      const total = enriched.reduce((s,i)=> s + i.price*i.qty, 0);
      const payload = encodeURIComponent(JSON.stringify({ items:enriched, total:+total.toFixed(2) }));
      return `${PAYPAL_URL}&mock_payload=${payload}`;
    }

    // Cart
    const cart=new Map();
    const cartCountEl=document.getElementById('cartCount');
    const cartList=document.getElementById('cartList');
    const checkoutTotal=document.getElementById('checkoutTotal');
    function money(n){return `$${n.toFixed(2)}`;}
    function calc(){let items=0,total=0; cart.forEach((q,id)=>{const p=PRODUCTS.find(x=>x.id===id); items+=q; total+=q*p.price;}); return {items,total};}
    function update(){
      const {items,total}=calc();
      cartCountEl.textContent=items; checkoutTotal.textContent=money(total); cartList.innerHTML='';
      cart.forEach((q,id)=>{const p=PRODUCTS.find(x=>x.id===id);
        const row=document.createElement('div');
        row.className='cart-item';
        row.innerHTML=`<div>${p.icon} ${p.name}</div>
          <div class="qty">
            <button data-act="dec" data-id="${id}">-</button>
            <span>${q}</span>
            <button data-act="inc" data-id="${id}">+</button>
          </div>
          <div>${money(p.price*q)}</div>`;
        cartList.appendChild(row);
      });
    }
    function renderPayPalButton(){
      const c=document.getElementById('paypal-button-container');
      c.innerHTML = '<button id="ppbtn" class="pp-btn" type="button">Pay with PayPal</button>';
      document.getElementById('ppbtn').addEventListener('click', ()=>{
        const val=calc().total; if(val<=0){ alert('Your cart is empty.'); return; }
        const items = Array.from(cart.entries()).map(([id,qty])=>({id,qty}));
        window.location.href = generatePayPalUrl(items);
      });
    }
    function toast(msg){
      const t=document.getElementById('toast');
      t.textContent='‚úì '+msg; t.style.transform='translateX(0)';
      setTimeout(()=>t.style.transform='translateX(120%)',2000);
    }
    grid.addEventListener('click', e=>{
      if(e.target.classList.contains('add')){
        const id=e.target.dataset.id; cart.set(id,(cart.get(id)||0)+1); update();
        const p=PRODUCTS.find(x=>x.id===id); toast(p.name+' added');
      }
    });
    cartList.addEventListener('click', e=>{
      if(e.target.dataset.act==='inc'){ const id=e.target.dataset.id; cart.set(id,(cart.get(id)||0)+1); update(); }
      if(e.target.dataset.act==='dec'){ const id=e.target.dataset.id; const q=(cart.get(id)||0)-1; if(q>0)cart.set(id,q); else cart.delete(id); update(); }
    });
    renderPayPalButton(); update();

    // Chat
    const chatFab=document.getElementById('chatFab');
    const chatPanel=document.getElementById('chatPanel');
    const chatBackdrop=document.getElementById('chatBackdrop');
    const chatClose=document.getElementById('chatClose');
    const chatBody=document.getElementById('chatBody');
    const chatForm=document.getElementById('chatForm');
    const chatInput=document.getElementById('chatInput');

    function addMsg(text, who='bot'){
      const el=document.createElement('div');
      el.className=`msg ${who}`;
      el.innerHTML=text;
      chatBody.appendChild(el);
      chatBody.scrollTop=chatBody.scrollHeight;
      return el;
    }
    function productChips(list){
      return list.map(p=>{
        const buyUrl = generatePayPalUrl([{id:p.id, qty:1}]);
        return `<div class="product-chip">
          <div>${p.icon} <span class="chip-title">${p.name}</span></div>
          <div class="small">${p.category} ‚Ä¢ ${p.unit}</div>
          <div class="chip-price">$${p.price.toFixed(2)}</div>
          <a class="pp-inline" href="${buyUrl}" target="_self">Pay with PayPal</a>
        </div>`;
      }).join('');
    }
    function bootChat(){
      if(chatBody.dataset.boot) return;
      chatBody.dataset.boot='1';
      const picks = PRODUCTS.slice(0,6);
      addMsg(`<b>Hi! I can find products and check you out with PayPal.</b><br>Ask me things like <i>snacks under $5</i> or <i>fruit</i>.<div style="margin-top:6px">${productChips(picks)}</div>`, 'bot');
    }
    function filterProducts(q){
      const query=(q||'').toLowerCase();
      let list=PRODUCTS.slice();
      const mUnder=query.match(/under\s*\$?(\d+(?:\.\d+)?)/);
      if(mUnder){ const cap=parseFloat(mUnder[1]); list=list.filter(p=>p.price<=cap); }
      const cats=categories.map(c=>c.toLowerCase());
      for(const c of cats){ if(query.includes(c)){ list=list.filter(p=>p.category.toLowerCase()===c); break; } }
      const cleaned=query.replace(/under\s*\$?\d+(?:\.\d+)?/,'').replace(/[^\w\s]/g,' ');
      const tokens=cleaned.split(/\s+/).filter(Boolean);
      if(tokens.length){ list=list.filter(p=>tokens.every(t=>(`${p.name} ${p.category}`).toLowerCase().includes(t))); }
      return list.slice(0,8);
    }
    function renderResults(list, prompt){
      if(!list.length){ addMsg(`No matches for <b>${prompt}</b>. Try another query.`, 'bot'); return; }
      const allUrl=generatePayPalUrl(list.map(p=>({id:p.id, qty:1})));
      addMsg(`I found <b>${list.length}</b> items for <b>${prompt}</b>.
        <div style="margin:8px 0 10px"><a class="pp-inline" href="${allUrl}" target="_self">Pay for all shown with PayPal</a></div>
        <div>${productChips(list)}</div>`, 'bot');
    }

    function openChat(){
      chatPanel.style.display='flex';
      requestAnimationFrame(()=>{ chatPanel.classList.add('open'); chatBackdrop.classList.add('show'); });
      bootChat();
      chatInput.focus();
    }
    function closeChat(){
      chatPanel.classList.remove('open'); chatBackdrop.classList.remove('show');
      setTimeout(()=>{ chatPanel.style.display='none'; }, 200);
    }

    if(chatFab) chatFab.addEventListener('click', openChat);
    if(chatClose) chatClose.addEventListener('click', closeChat);
    if(chatBackdrop) chatBackdrop.addEventListener('click', closeChat);

    // Swipe-to-close (mobile Safari friendly)
    let startY=null, currentY=null, dragging=false;
    chatPanel.addEventListener('touchstart',(e)=>{
      if(e.touches.length!==1) return;
      startY=e.touches[0].clientY; dragging=true; chatPanel.style.transition='none';
    });
    chatPanel.addEventListener('touchmove',(e)=>{
      if(!dragging) return;
      currentY=e.touches[0].clientY;
      const dy=Math.max(0, currentY-startY);
      chatPanel.style.transform=`translateY(${dy}px)`;
    });
    chatPanel.addEventListener('touchend',()=>{
      if(!dragging) return;
      dragging=false; chatPanel.style.transition='';
      const dy=Math.max(0,(currentY||0)-(startY||0));
      if(dy>120){ closeChat(); chatPanel.style.transform=''; }
      else { chatPanel.style.transform=''; chatPanel.classList.add('open'); }
    });
  </script>
</body>
</html>
